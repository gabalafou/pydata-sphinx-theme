/*******************************************************************************
 * PyData Sphinx Theme replacement stylesheet for MyST-NB
 *
 * MyST-NB is a Sphinx extension for turning Jupyter notebooks (.ipynb) into
 * doc pages.
 *
 * This stylesheet is a replacement for MyST-NB's default stylesheet,
 * mystnb.{sha256}.css. Some of the style rules in this file were copied
 * from there.
 *
 * This file implements Isabela's design for notebook code cells:
 * https://github.com/Quansight-Labs/czi-scientific-python-mgmt/issues/142#issuecomment-2759132381.
 */

@import "../abstracts/all";

// Prevent tables from scrunching together
div.cell_input {
  display: flex;
  flex-direction: column;
  justify-content: stretch;
}

div.cell_input,
div.output {
  border-radius: $admonition-border-radius;
}

div.output {
  table {
    table-layout: auto;
  }
}

div.container.cell {
  // Vertical whitespace between notebook code cell area (input + output) and
  // surrounding prose
  margin-top: 1.2em;
  margin-bottom: 1.2em;

  // Styles for vertical bar
  position: relative; // must set position relative in order to set position absolute on ::before pseudo-element
  &::before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    width: 0.2em;
    background: var(--pst-color-success);
    border-radius: 1px;
  }

  // Space between vertical left bar and code cells
  padding-left: 1em;

  // "In:" and "Out:" labels
  .cell_input::before {
    content: "In:";
  }

  .cell_output::before {
    content: "Out:";
  }

  .cell_input,
  .cell_output {
    background-color: transparent; // override MyST-NB
    border: none; // override MyST-NB

    // shared label styles
    &::before {
      display: block;
      font-family: var(--pst-font-family-monospace);
      font-size: 0.875rem; // match nbsphinx label font-size
      line-height: 1; // align top of label with top of left bar
      margin-bottom: 0.7em;
    }
  }

  .cell_input {
    margin-bottom: 1.2em;
  }

  .cell_output {
    margin-top: 1.2em;

    .stderr pre {
      background-color: var(--pst-color-danger-bg);
    }

    .output {
      &.text_html {
        max-width: 100%;
        overflow-x: auto;
      }

      &:first-child {
        margin-top: 0; // override MyST-NB (let the margin-top rule on .cell_output control the whitespace)
      }

      :last-child:not(.highlight, .widget-tab-contents, .jupyter-widgets) {
        margin-top: 0;
        margin-bottom: 0;
      }

      &.traceback {
        background: transparent;
        border: none;

        pre {
          border: 1px solid var(--pst-color-danger);
        }
      }
    }

    // pandas
    table.dataframe {
      @include table-colors;

      tbody {
        tr:hover {
          background-color: var(--pst-color-table-row-hover-bg);
        }
      }
    }

    // some notebook outputs (such as images and ipywidgets) are typically
    // generated for light mode and do not adapt well to dark mode
    .text_html:not(:has(table.dataframe)),
    // ipywidgets
    .widget-subarea {
      @include cell-output-force-light-background;
    }
  }
}
